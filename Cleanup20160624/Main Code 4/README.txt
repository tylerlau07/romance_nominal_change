This version guesses the suffixes and rebuilds the input each time
